# ANYTLS: A Multiplexed Application-Layer Connection Protocol over TLS

# Overview

ANYTLS is a multiplexed application layer connection protocol. 

This document defines version 1 of ANYTLS.

## Terms and Definitions

The key words "**MUST**", "**MUST NOT**", "**REQUIRED**", "**SHALL**", "**SHALL NOT**", "**SHOULD**", "**SHOULD NOT**", "**RECOMMENDED**", "**NOT RECOMMENDED**", "**MAY**", and "**OPTIONAL**" in this document are to be interpreted as described in BCP 14 [[RFC2119](https://datatracker.ietf.org/doc/html/rfc2119)] [[RFC8174](https://datatracker.ietf.org/doc/html/rfc8174)] when, and only when, they appear in all capitals, as shown here.

Commonly used terms in this document are described below.

- **ANYTLS:** The protocol described by this document.
- **Endpoint:** An entity that can participate in a ANYTLS connection by generating, receiving, and processing ANYTLS frames. There are only two types of endpoints in ANYTLS: client and server.
- **Client:** The endpoint that initiates a ANYTLS connection.
- **Server:** The endpoint that accepts a ANYTLS connection.
- **Frame:** A unit of structured protocol information. There are multiple frame types, each of which carries different information. Frames are contained in TLS Record Section
- **ANYTLS Connection:** Logically, ANYTLS Connection is an upgrade from TLS Connection, but in reality, ANYTLS Connection is still TLS Connection.
- **Stream:** A bidirectional channel of ordered bytes within a ANYTLS connection. A ANYTLS connection can carry multiple simultaneous streams.
- **Stream ID**: It is used to identify different streams in an ANYTLS connection.
- **Application:** An entity that uses ANYTLS to send and receive data.

This document uses the terms "ANYTLS Frame", "TLS Record", and "TCP packets" to refer to the units of the respective protocols. 

That is, one or more ANYTlS frame can be encapsulated in a TLS record, which is in turn encapsulated in an TCP packet.

## Notational Conventions

Frame diagrams in this document use a custom format. The purpose of this format is to summarize, not define, protocol elements. Prose defines the complete semantics and details of structures.

Complex fields are named and then followed by a list of fields surrounded by a pair of matching braces. Each field in this list is separated by commas.

Individual fields include length information, plus indications about fixed value, optionality, or repetitions. Individual fields use the following notational conventions, with all lengths in bits:

**x (A):** Indicates that x is A bits long

**x (i):** Indicates that x holds an integer value using the variable-length encoding described in [Section 16](https://datatracker.ietf.org/doc/html/rfc9000#integer-encoding)

**x (A..B):** Indicates that x can be any length from A to B; A can be omitted to indicate a minimum of zero bits, and B can be omitted to indicate no set upper limit; values in this format always end on a byte boundary

**x (L) = C:** Indicates that x has a fixed value of C; the length of x is described by L, which can use any of the length forms above

**x (L) = C..D:** Indicates that x has a value in the range from C to D, inclusive, with the length described by L, as above

**[x (L)]:** Indicates that x is optional and has a length of L

**x (L) ...:** Indicates that x is repeated zero or more times and that each instance has a length of L

This document uses network byte order (that is, big endian) values. Fields are placed starting from the high-order bits of each byte.

By convention, individual fields reference a complex field by using the name of the complex field.

```
Example Structure {
  One-bit Field (1),
  7-bit Field with Fixed Value (7) = 61,
  Field with Variable-Length Integer (i),
  Arbitrary-Length Field (..),
  Variable-Length Field (8..24),
  Field With Minimum Length (16..),
  Field With Maximum Length (..128),
  [Optional Field (64)],
  Repeated Field (8) ...,
}
```
